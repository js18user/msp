<!DOCTYPE html>
<html lang="eu">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="author" content="js18user">
        <link rel="icon" href="https://www.w3.org/assets/logos/w3c-2025/favicons/favicon.ico" crossorigin>
        <title>admin</title>
    </head>
    <style>@supports (scrollbar-gutter :stable){.container{padding-right:0;scrollbar-width:thin;scrollbar-gutter:stable}}.main{display:none;position:absolute;top:0;left:0;width:100%;height:100%}.wind{width:588px;height:892px;text-align:center;padding:10px;border:2px solid #00c;border-radius:10px;color:#00c;background-color:#fff;position:absolute;top:0;right:0;bottom:0;left:2;margin:auto}.main:target{display:block}main{max-width:38rem;padding:22rem;margin:auto}h1,h3,h4,h5,h6{margin:3em 0 1em;color:blue;background-color:#fff}h2{color:blue;background-color:#fff}ul,ol{margin-bottom:2em;color:#1d1d1d;font-family:sans-serif;width:800px;margin:9px;font-size:17px;text-align:justify;line-height:1}td{padding:1px}button{border-radius:18%;border:2px solid FireBrick;font-size:13px;margin:3px;line-height:1.2;text-align:justify;width:100px;background-color:RoyalBlue;color:#fff}button:visited{color:green;text-decoration:none}button:hover{color:red;text-decoration:underline;transform:scale(1.04)}button:active{color:yellow;text-decoration:underline}.begin{line-height:50em}.scroll-table-body{height:840px;overflow-x:auto;color:DarkBlue;margin-top:0;margin-bottom:20px;border-bottom:1px solid #eee}.scroll-table table{width:100%;border:none}.scroll-table th{font-weight:700;text-align:left;border:none;padding:5px 15px;background:#d8d8d8;font-size:18px;border-left:1px solid #ddd;border-right:1px solid #ddd;color:MediumBlue}.scroll-table td{text-align:left;border-left:1px solid #ddd;border-right:1px solid #ddd;padding:0 15px;font-size:16px;vertical-align:top}::-webkit-scrollbar{width:6px}label{color:DarkBlue}input{background-color:RoyalBlue;color:#fff;border:1px solid FireBrick;font-family:'Uncut';font-size:16px}#distributionTeg{width:162px}#distributionMob{width:60px}#distributionText{width:1000px}#distributionStart_date{height:20px;empty-cells:show}#distributionEnd_date{height:20px;empty-cells:show}#saveBtn{background-color:LightSeaGreen;color:#fff}#resetBtn{background-color:RoyalBlue;color:#fff}#selectBtn{background-color:blue;color:#fff}#deleteBtn{background-color:FireBrick;color:#fff}#updateGlBtn{color:#fff;background-color:SteelBlue}.updateDistribution{color:#fff;background-color:SteelBlue}.deleteDistribution{color:#fff;background-color:FireBrick;border:2px solid blue}.begin{line-height:0%}.idr{width:28px}.idm{width:20px}.text{width:24em}.teg{width:1em}#footer{position:fixed;left:0;bottom:0;padding:7px;background:SteelBlue;color:MediumBlue;width:100%}#content{top:24px;left:550px;bottom:50;right:100;position:fixed;color:#b30000;margin-bottom:50px;html{overflow-y:scroll;scrollbar-gutter:stable}.loading-state{scrollbar-gutter:stable}.article{content-visibility:auto;contain -intrinsic-size:400px}</style>
    <body translate="no"><nav class="container"><div id="content" class="errorMessage"></div><div class="begin"><input type="hidden" id="distributionId"><input type="hidden" id="messageId"><p><label for="distributionStart_date">Start date:</label><input id="distributionStart_date" required type="datetime-local" spellcheck="true"></p><p><label for="distributionEnd_date">End date:&nbsp;</label><input id="distributionEnd_date" required type="datetime-local" spellcheck="true"></p><p><label for="distributionTeg">Teg:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input id="distributionTeg" required type="text" list="browsers"><datalist id="browsers"><option value="message"><option value="control"></datalist></p><p><label for="distributionMob">Mob &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</label><input id="distributionMob" type="number" spellcheck="true" min="901" max="999" required></p><p><label for="distributionText">Text:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input id="distributionText" required type="text" placeholder="e.g. your message for clients"></p><p><button id="saveBtn">Save</button><button id="resetBtn">Reset</button><button id="selectBtn">Select</button><button id="deleteBtn">Delete</button><button id="updateGlBtn">UpdateGlobal</button></p></div><div class="scroll-table"><table><thead><tr><th>|............................................................... MESSAGES ....................................................| |...... DISTRIBUTIONS .....| </th><th>&nbsp;&nbsp;ID&nbsp;</th><th>&nbsp;&nbsp;&nbsp;START DATE&nbsp;&nbsp;&nbsp;&nbsp;</th><th>&nbsp; END DATE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th><th> TEG &nbsp;</th><th>mb</th><th>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; TEXT &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</th></tr></thead></table><div class="scroll-table-body"><table id="tableId" class="tbl"><tbody id="sid"><tr></tr></tbody></table></div></div><div id="footer"></div></nav>
        <script async>/* after ts */ "use strict";async function adminMessage(error){let messageError=document.querySelector("div");messageError.setAttribute('class',"errorMessage");document.getElementById('content').textContent='';messageError.append(error)}
        async function responseError(response){await adminMessage(["Error -->",response.status,response.statusText].join())}
        async function removeTableBody(){tableId.replaceChild(document.createElement(tbs),tableId.tBodies[0])}
        async function getDistributions(){let response=await fetch('/admin/distribution',{headers:{'Content-Type':'application/json'}});if(response.ok){let distributions=await response.json(),rows=document.querySelector(tbs);await getDistribution(distributions.at(0),0);for await(let distribution of distributions){rows.append(await row(distribution))};document.getElementById("distributionId").value=""}else await responseError(response)}
        async function getMessages(distribution,status){let url='';status==="com"?url=`/admin/message?id_distribution=${distribution.id}`:url=`/admin/message/status?id_distribution=${distribution.id}&status=${status}`;let response=await fetch(url,{headers:{'Content-Type':'application/json'}});if(response.ok)return await response.json();else await responseError(response)}
        async function getDistribution(distribution,list_number){[document.getElementById("distributionId").value,document.getElementById("distributionStart_date").value,document.getElementById("distributionEnd_date").value,document.getElementById("distributionTeg").value,document.getElementById("distributionMob").value,document.getElementById("distributionText").value]=[distribution.id,distribution.start_date,distribution.end_date,distribution.teg,distribution.mob,distribution.text];await adminMessage(["Ready for Update distribution ID="+distribution.id," change the attributes and click Save button."," For Update others distributions click Update button by match."," For Create a new Distribution click Reset button."," Messages are ready for viewing.Click the appropriate button."].join())}
        async function getDistributionStatistic(id_number){let response=await fetch(`/admin/statistic?id=${id_number}`,{headers:{'Content-Type':'application/json'}});if(response.ok)return await response.json();else await responseError(response)}
        async function createDistribution(distributionStart_date,distributionEnd_date,distributionTeg,distributionMob,distributionText){let one=1;let en=900;if(distributionStart_date===""||distributionEnd_date===""||Date.now()>Date.parse(distributionStart_date)||Date.now()>Date.parse(distributionEnd_date)||Date.parse(distributionStart_date)>Date.parse(distributionEnd_date)||distributionTeg===""||distributionText===""||distributionTeg.length<one||distributionText.length<one||distributionMob===""||distributionMob<en||distributionMob>999)await adminMessage(["Error -->...life is hard...very hard.It must be repeated...",Date()].join());else{await adminMessage("");let response=await fetch("/distribution",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({start_date:distributionStart_date,end_date:distributionEnd_date,teg:distributionTeg,mob:distributionMob,text:distributionText,})});if(response.ok){let distribution=await response.json();await getDistribution(distribution.at(0),0);document.getElementById("distributionId").value="";await adminMessage(["Created distribution ID="+distribution.at(0)['id'],response.status,response.statusText," Press the UpdateGlobal button to monitor the status of messages"].join())}else await responseError(response)}}
        async function editDistribution(id,start_date,end_date,teg,mob,text){let response=await fetch("/distribution",{method:"PUT",headers:{'Content-Type':'application/json'},body:JSON.stringify({distribution:{id:id,},upd:{start_date:start_date,end_date:end_date,teg:teg,mob:mob,text:text,},})});if(response.ok){let listDistributionStatistic=await getDistributionStatistic(id);document.querySelector(`tr[data-rowid="${listDistributionStatistic[0].id}"]`).replaceWith(await row(listDistributionStatistic[0]));await adminMessage(["Updated distribution ID=",id,response.status,response.statusText," Press the UpdateGlobal button to monitor the status of messages"].join())}else await responseError(response)}
        async function deleteDistribution(distribution){let response=await fetch(`/distribution`,{method:"DELETE",headers:{'Content-Type':'application/json'},body:JSON.stringify({id:distribution.id,})});if(response.ok){await adminMessage(["Deleted distribution ID="+distribution.id," with messages"].join());document.querySelector(`tr[data-rowid='${distribution.id}']`).remove()}else await responseError(response)}
        async function showMessages(distribution,list_number,status){await getDistribution(distribution,list_number);await displayMessage(distribution,status);return}
        async function reset(){[document.getElementById("distributionId").value,document.getElementById("distributionStart_date").value,document.getElementById("distributionEnd_date").value,document.getElementById("distributionText").value,document.getElementById("distributionTeg").value,document.getElementById("distributionMob").value]=["","","","","message",906];await adminMessage(["Ready for CREATE a new Distribution",".Enter the attributes and click Save button."].join())}
        async function updateGlobal(){let response=await fetch('/admin/distribution',{method:"GET",headers:{'Content-Type':'application/json'},});if(response.ok){let distributions=await response.json();await removeTableBody();await getDistribution(distributions.at(0),0);let rows=document.querySelector(tbs);for await(let distribution of distributions){rows.append(await row(distribution))};document.getElementById("distributionId").value="";await adminMessage("All updated")}else await responseError(response)}
        async function row(distribution){let[trs,linksTd,showCom,showFormed,showQueue,showSent,showFailure,showExpired,editLink,removeLink,idTd,start_dateTd,end_dateTd,tegTd,mobTd,textTd]=[document.createElement("tr"),document.createElement("td"),document.createElement("button"),document.createElement("button"),document.createElement("button"),document.createElement("button"),document.createElement("button"),document.createElement("button"),document.createElement("button"),document.createElement("button"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];trs.setAttribute("data-rowid",distribution.id);tegTd.setAttribute("class","teg");textTd.setAttribute("class","text");editLink.setAttribute('class','updateDistribution');removeLink.setAttribute('class','deleteDistribution');[showCom.innerText,showFormed.innerText,showQueue.innerText,showSent.innerText,showFailure.innerText,showExpired.innerText,editLink.innerText,removeLink.innerText,idTd.innerText,start_dateTd.innerText,end_dateTd.innerText,tegTd.innerText,mobTd.innerText,textTd.innerText]=["Com "+distribution.com,"Formed "+distribution.formed,"Queue "+distribution.queue,"Sent "+distribution.sent,"Failure "+distribution.failure,"Expired "+distribution.expired,"Update","Delete",distribution.id,distribution.start_date,distribution.end_date,distribution.teg.substring(0,8),distribution.mob,distribution.text];linksTd.append(showCom,showFormed,showQueue,showSent,showFailure,showExpired,editLink,removeLink);trs.appendChild(linksTd);trs.append(idTd,start_dateTd,end_dateTd,tegTd,mobTd,textTd);showCom.addEventListener("click",async()=>await showMessages(distribution,distribution.id,"com"));showFormed.addEventListener("click",async()=>await showMessages(distribution,distribution.id,"formed"));showQueue.addEventListener("click",async()=>await showMessages(distribution,distribution.id,"queue"));showSent.addEventListener("click",async()=>await showMessages(distribution,distribution.id,"sent"));showFailure.addEventListener("click",async()=>await showMessages(distribution,distribution.id,"failure"));showExpired.addEventListener("click",async()=>await showMessages(distribution,distribution.id,"expired"));editLink.addEventListener("click",async()=>await getDistribution(distribution,distribution.id));removeLink.addEventListener("click",async()=>await deleteDistribution(distribution));return await trs}
        async function rowMessage(message){let[trs,idTd,start_dateTd,phoneTd,timezoneTd,statusTd]=[document.createElement("tr"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];trs.setAttribute("data-rowid",message.id);[idTd.innerText,start_dateTd.innerText,phoneTd.innerText,timezoneTd.innerText,statusTd.innerText]=[message.id,message.start_date,message.phone,"00"+message.timezone,message.status];trs.append(idTd,start_dateTd,phoneTd,timezoneTd,statusTd);return await trs}document.getElementById("resetBtn").addEventListener("click",async()=>reset());document.getElementById("updateGlBtn").addEventListener("click",async()=>updateGlobal());document.getElementById("saveBtn").addEventListener("click",async()=>{let[id,start_date,end_date,teg,mob,text]=[document.getElementById("distributionId").value,document.getElementById("distributionStart_date").value,document.getElementById("distributionEnd_date").value,document.getElementById("distributionTeg").value,document.getElementById("distributionMob").value,document.getElementById("distributionText").value];id===""?await createDistribution(start_date,end_date,teg,mob,text):await editDistribution(id,start_date,end_date,teg,mob,text)});async function displayMessage(distribution,status){let[messages,html,windowRight,closeBtn,divCom,table,tHead,tr,messageId,messageStart_date,messagePhone,messageTimezone,messageStatus,divBody,rows]=[await getMessages(distribution,status),document.querySelector('html'),document.createElement('div'),document.createElement('button'),document.createElement('div'),document.createElement('table'),document.createElement('tHead'),document.createElement('tr'),document.createElement('th'),document.createElement('th'),document.createElement('th'),document.createElement('th'),document.createElement('th'),document.createElement('div'),document.createElement(tbs)];windowRight.setAttribute('class','wind');html.appendChild(windowRight);closeBtn.textContent='Close window';windowRight.appendChild(closeBtn);closeBtn.onclick=async function(){windowRight.parentNode.removeChild(windowRight)};divCom.setAttribute('class',"scroll-table");windowRight.appendChild(divCom);divCom.appendChild(table);table.appendChild(tHead);tHead.appendChild(tr);messageId.textContent="(id)";tr.appendChild(messageId);messageStart_date.textContent=".........Date operation.........";tr.appendChild(messageStart_date);messagePhone.textContent="....Phone....";tr.appendChild(messagePhone);messageTimezone.textContent="utc";tr.appendChild(messageTimezone);messageStatus.textContent="Status";tr.appendChild(messageStatus);divBody.setAttribute('class',"scroll-table-body");divCom.appendChild(divBody);let i;let l=messages.length;for(i=0;i<l;i++){rows.append(await rowMessage(messages.at(i)))};divBody.appendChild(rows)}let tbs="TBody";
        (async function(){await getDistributions()}())</Script>
    </body>
</html>
